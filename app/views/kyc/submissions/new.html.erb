<% content_for :title, "Submit KYC Documents" %>

<div class="max-w-2xl mx-auto py-8 px-4">
  <div class="bg-white rounded-lg shadow-md p-6">
    <h1 class="text-2xl font-bold text-gray-900 mb-6">Submit KYC Documents</h1>
    
    <p class="text-gray-600 mb-6">
      To start borrowing, we need to verify your identity. Please upload clear photos of your government ID and a selfie.
    </p>

    <%= form_with(url: kyc_path, method: :post, local: true, multipart: true, 
                  class: "space-y-6", scope: :kyc) do |form| %>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= form.label :full_name, "Full Name", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_field :full_name, 
                              value: @kyc_form_data[:full_name],
                              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                              required: true %>
        </div>

        <div>
          <%= form.label :phone, "Phone Number", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.telephone_field :phone, 
                                   value: @kyc_form_data[:phone],
                                   readonly: current_user.phone.present?,
                                   class: "w-full px-3 py-2 border border-gray-300 rounded-md #{current_user.phone.present? ? 'bg-gray-100' : ''} focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" %>
          <% if current_user.phone.present? %>
            <p class="text-xs text-gray-500 mt-1">Phone number cannot be changed after registration</p>
          <% end %>
        </div>

        <div>
          <%= form.label :date_of_birth, "Date of Birth", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.date_field :date_of_birth, 
                              value: @kyc_form_data[:date_of_birth],
                              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                              max: 18.years.ago.to_date,
                              required: true %>
          <p class="text-xs text-gray-500 mt-1">Must be 18 years or older</p>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= form.label :gov_id_type, "Government ID Type", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.select :gov_id_type, 
                          [
                            ["Driver's License", "drivers_license"],
                            ["Passport", "passport"],
                            ["UMID", "umid"],
                            ["SSS ID", "sss"],
                            ["PhilHealth ID", "philhealth"],
                            ["Postal ID", "postal"],
                            ["Voter's ID", "voters"]
                          ],
                          { prompt: "Select ID type" },
                          { class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent", required: true } %>
        </div>

        <div>
          <%= form.label :gov_id_number, "ID Number", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_field :gov_id_number, 
                              value: @kyc_form_data[:gov_id_number],
                              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                              required: true %>
          <p class="text-xs text-gray-500 mt-1">Only last 4 digits will be stored for security</p>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <%= form.label :id_expiry, "ID Expiry Date", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.date_field :id_expiry, 
                              value: @kyc_form_data[:id_expiry],
                              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                              required: true %>
        </div>

        <div>
          <%= form.label :address_line1, "Address", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_field :address_line1, 
                              value: @kyc_form_data[:address_line1],
                              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                              placeholder: "Street, Barangay, City",
                              required: true %>
        </div>
      </div>

      <div class="space-y-4">
        <div>
          <%= form.label :gov_id_image, "Government ID Photo", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.file_field :gov_id_image, 
                              accept: "image/png,image/jpeg",
                              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                              required: true %>
          <p class="text-xs text-gray-500 mt-1">PNG or JPEG, max 5MB. Ensure all text is clearly readable.</p>
        </div>

        <div>
          <%= form.label :selfie_image, "Selfie Photo", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.file_field :selfie_image, 
                              accept: "image/png,image/jpeg",
                              class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                              required: true %>
          <p class="text-xs text-gray-500 mt-1">PNG or JPEG, max 5MB. Clear photo of your face.</p>
        </div>
      </div>

      <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
        <h3 class="text-sm font-medium text-blue-800 mb-2">Privacy Notice</h3>
        <p class="text-xs text-blue-700">
          Your documents are encrypted and securely stored. We only use this information for identity verification 
          and compliance purposes. Your ID number will be masked for security.
        </p>
      </div>

      <div class="flex justify-end space-x-4">
        <%= link_to "Cancel", root_path, 
                    class: "px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        <%= form.submit "Submit Documents", 
                        class: "px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" %>
      </div>
    <% end %>
  </div>
</div>
